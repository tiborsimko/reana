{{- if and .Values.opensearch.enabled .Values.opensearch.customSecurityConfig }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "reana.prefix" . }}-opensearch-config-secrets
  namespace: {{ .Release.Namespace }}
type: kubernetes.io/opaque
stringData:
  {{- if .Values.opensearch.customSecurityConfig.internalUsers }}
  internal_users.yml: |
    ---
    # This is the internal user database
    # The hash value is a bcrypt hash and can be generated with plugin/tools/hash.sh
    _meta:
      type: "internalusers"
      config_version: 2
    {{ .Values.opensearch.customSecurityConfig.internalUsers | toYaml | nindent 4 }}
  {{- end }}
  {{- if .Values.opensearch.customSecurityConfig.rolesMapping }}
  roles_mapping.yml: |
    ---
    # In this file users, backendroles and hosts can be mapped to Security roles.
    # Permissions for OpenSearch roles are configured in roles.yml
    _meta:
      type: "rolesmapping"
      config_version: 2
    {{ .Values.opensearch.customSecurityConfig.rolesMapping | toYaml | nindent 4 }}
  {{- end }}
  {{- if .Values.opensearch.customSecurityConfig.roles }}
  roles.yml: |
    ---
    _meta:
      type: "roles"
      config_version: 2
    # The security REST API access role is used to assign specific users access to change the security settings through the REST API.
    security_rest_api_access:
      reserved: true
    {{ .Values.opensearch.customSecurityConfig.roles | toYaml | nindent 4 }}
  {{- end }}
{{- end }}
